ADMIN PANEL LOGIN TROUBLESHOOTING GUIDE
========================================

STEP 1: TEST ENVIRONMENT VARIABLE
----------------------------------
Visit: https://posteradmin.lapoelectioncart.com/env-test

This page will show:
- Current API_URL value
- All environment variables
- Test API connection button

Expected API_URL: https://postermaker-backend.onrender.com
If you see: http://localhost:8000 → Environment variable NOT set!

STEP 2: CHECK VERCEL ENVIRONMENT VARIABLE
------------------------------------------
1. Go to: https://vercel.com/dashboard
2. Click on your admin panel project
3. Go to: Settings → Environment Variables
4. Check if VITE_API_URL exists

If MISSING or WRONG:
   Name: VITE_API_URL
   Value: https://postermaker-backend.onrender.com
   
   IMPORTANT:
   - Must start with https://
   - No trailing slash
   - Exact URL above

5. After adding/updating:
   - Go to Deployments tab
   - Click "..." on latest deployment
   - Click "Redeploy"
   - Wait for deployment to complete

STEP 3: CHECK BROWSER CONSOLE
------------------------------
1. Open: https://posteradmin.lapoelectioncart.com
2. Press F12 (open DevTools)
3. Go to Console tab
4. Try to login
5. Look for errors:

Common Errors:

a) "Failed to fetch" or "Network Error"
   → Backend is down or URL is wrong
   → Check VITE_API_URL in Vercel

b) "CORS error" or "Access-Control-Allow-Origin"
   → Backend CORS not configured
   → Update CORS_ALLOWED_ORIGINS on Render

c) "401 Unauthorized"
   → Wrong credentials
   → Use: aseeb / Dr.aseeb123

d) "400 Bad Request"
   → Backend ALLOWED_HOSTS not configured
   → Update ALLOWED_HOSTS on Render

STEP 4: TEST BACKEND DIRECTLY
------------------------------
Open new browser tab and visit:
https://postermaker-backend.onrender.com/api/admin/login/

Expected: JSON response like {"error": "Invalid credentials"}
If you see: 400 Bad Request → Backend not configured correctly

STEP 5: CHECK NETWORK TAB
--------------------------
1. Open: https://posteradmin.lapoelectioncart.com
2. Press F12 → Network tab
3. Try to login
4. Look for the login request

Check:
- Request URL: Should be https://postermaker-backend.onrender.com/api/admin/login/
- Status: Should be 401 (wrong credentials) or 200 (success)
- If localhost in URL → Environment variable not working!

STEP 6: VERIFY BACKEND CONFIGURATION
-------------------------------------
Backend on Render must have these environment variables:

ALLOWED_HOSTS = postermaker-backend.onrender.com
CORS_ALLOWED_ORIGINS = https://poster.lapoelectioncart.com,https://posteradmin.lapoelectioncart.com
DEBUG = False
SECRET_KEY = <your-secret-key>
DATABASE_URL = <auto-populated>

To check:
1. Go to: https://dashboard.render.com
2. Click "postermaker-backend"
3. Click "Environment" tab
4. Verify all variables are set

STEP 7: CLEAR CACHE AND RETRY
------------------------------
Sometimes old cached files cause issues:

1. Clear browser cache:
   - Chrome: Ctrl+Shift+Delete
   - Select "Cached images and files"
   - Click "Clear data"

2. Hard refresh:
   - Windows: Ctrl+Shift+R
   - Mac: Cmd+Shift+R

3. Try login again

STEP 8: TEST WITH CURL
-----------------------
Test backend from command line:

curl -X POST https://postermaker-backend.onrender.com/api/admin/login/ \
  -H "Content-Type: application/json" \
  -d '{"username":"aseeb","password":"Dr.aseeb123"}'

Expected: JSON with token
If error: Backend issue

COMMON ISSUES & SOLUTIONS
--------------------------

Issue: Login button does nothing
Solution: 
- Check browser console for errors
- Verify VITE_API_URL in Vercel
- Check /env-test page

Issue: "Network Error"
Solution:
- Backend might be sleeping (Render free tier)
- Wait 30 seconds and try again
- Check backend is running on Render

Issue: CORS error
Solution:
- Update CORS_ALLOWED_ORIGINS on Render
- Must include: https://posteradmin.lapoelectioncart.com
- No spaces, comma separated

Issue: 400 Bad Request
Solution:
- Update ALLOWED_HOSTS on Render
- Must include: postermaker-backend.onrender.com

Issue: 401 Unauthorized
Solution:
- Check credentials: aseeb / Dr.aseeb123
- Verify superuser exists in backend

Issue: Environment variable not working
Solution:
- Redeploy on Vercel after adding variable
- Check /env-test page to verify
- Make sure variable name is exactly: VITE_API_URL

CHECKLIST
---------
[ ] Backend is running on Render
[ ] ALLOWED_HOSTS includes postermaker-backend.onrender.com
[ ] CORS_ALLOWED_ORIGINS includes posteradmin.lapoelectioncart.com
[ ] VITE_API_URL set in Vercel
[ ] Admin panel redeployed after adding variable
[ ] /env-test shows correct API URL
[ ] Browser console shows no errors
[ ] Backend /api/admin/login/ returns JSON (not 400)

QUICK TEST SEQUENCE
--------------------
1. Visit: https://posteradmin.lapoelectioncart.com/env-test
   → Should show: https://postermaker-backend.onrender.com

2. Visit: https://postermaker-backend.onrender.com/api/admin/login/
   → Should show: JSON response (not 400)

3. Visit: https://posteradmin.lapoelectioncart.com
   → Try login with: aseeb / Dr.aseeb123
   → Should redirect to dashboard

If any step fails, check that specific issue above.

CREDENTIALS
-----------
Username: aseeb
Password: Dr.aseeb123

These are created automatically by ensuresuperuser.py during deployment.
